<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>í”¼ë“œ - ë¯¸ë‹ˆ ë¸”ë¡œê·¸</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f9f9f9; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .card { background: white; border: 1px solid #ddd; padding: 15px; border-radius: 8px; margin-bottom: 10px; }
        textarea { width: 100%; padding: 10px; box-sizing: border-box; }
        button { padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; background-color: #007bff; color: white; }
    </style>
</head>
<body>
<div class="header">
    <h2 id="welcome-msg">í™˜ì˜í•©ë‹ˆë‹¤</h2>
    <button onclick="logout()" style="background-color: #6c757d;">ë¡œê·¸ì•„ì›ƒ</button>
</div>

<div style="margin-bottom: 20px;">
    <button onclick="loadArticles('my')">ë‚´ ê¸€</button>
    <button onclick="loadArticles('feed')">ì¹œêµ¬ ê¸€(í”¼ë“œ)</button>
</div>

<div class="card">
    <textarea id="content" placeholder="ë¬´ìŠ¨ ì¼ì´ ìˆì—ˆë‚˜ìš”?"></textarea>
    <button onclick="writeArticle()" style="margin-top:5px;">ì‘ì„±</button>
</div>

<div id="list"></div>

<script>
    const BASE_URL = '/api/v1';
    // ì €ì¥ëœ ID ê°€ì ¸ì˜¤ê¸°
    const myId = localStorage.getItem('userId');
    const myName = localStorage.getItem('userName');

    // ë¡œê·¸ì¸ ì•ˆí–ˆìœ¼ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì«“ì•„ë‚´ê¸°
    if (!myId) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        location.href = 'login.html';
    }

    document.getElementById('welcome-msg').innerText = `ğŸ‘¤ ${myName}ë‹˜ì˜ í”¼ë“œ`;

    // ì‹œì‘í•˜ë©´ 'ë‚´ ê¸€' ë¨¼ì € ë³´ì—¬ì£¼ê¸°
    window.onload = () => loadArticles('my');

    async function loadArticles(type) {
        let url = (type === 'my')
            ? `${BASE_URL}/article?authorId=${myId}`
            : `${BASE_URL}/feed?followerId=${myId}`;

        const res = await fetch(url);
        const data = await res.json();

        const listDiv = document.getElementById('list');
        listDiv.innerHTML = '';

        if(data.length === 0) listDiv.innerHTML = '<p>ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';

        data.forEach(article => {
            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `<p>${article.content}</p><small style="color:grey">ì‘ì„±ì ID: ${article.authorId}</small>`;
            listDiv.appendChild(div);
        });
    }

    async function writeArticle() {
        const content = document.getElementById('content').value;
        if(!content) return;
        await fetch(`${BASE_URL}/article`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ authorId: myId, content })
        });
        document.getElementById('content').value = '';
        loadArticles('my');
    }

    function logout() {
        localStorage.clear(); // ì €ì¥ëœ ID ì‚­ì œ
        location.href = 'login.html'; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
    }
</script>
</body>
</html>